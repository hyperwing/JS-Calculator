<!-- File Created 10/16/2019 by Neel Mansukhani -->
<!-- Edited 10/17/2019 by Neel Mansukhani: Added number input events -->
<!-- Edited 10/17/2019 by Sri Ramya Dandu: Added memory buttons and logic for clear,recall, and display-->
<!-- Edited 10/18/2019 by Neel Mansukhani: Added operators -->
<!-- Edited 10/18/2019 by Sharon Qiu: Added memory buttons for simple operations and memory storing  -->
<!-- Edited 10/18/2019 by Sri Ramya Dandu: Refactored code for memory functions and modified appearce of memory stack -->
<!-- Edited 10/19/2019 by David Wing: Wrote functionality for clear line and clear history-->
<!-- Edited 10/18/2019 by Sri Ramya Dandu: Fixed resziing of memory display -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="memoryFunctions.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Javascript Calculator</title>
    <link rel="stylesheet" type="text/css" href="calculator.css">
  </head>
  <body>
    <table class="calculator">
        <tr>
            <td id="calculations" colspan="4"></td>
        </tr>
        <tr>
            <td id="display" colspan="4">0</td> 
        </tr>

        <tr>
            <td><button id = "MC" onclick="clearMemory()" disabled>MC</button></td>
            <td><button id="MR" onclick="memoryRecall()" disabled>MR</button></td>
            <td><button onclick="storeMemory()">MS</button></td>
            <td><button id= "M" onclick="displayMemory()">M&#9654;</button></td>
        </tr>
        <tr>
            <td><button onclick="onOperatorClick('CE')">CE</button></td>
            <td><button onclick="onOperatorClick('C')">C</button></td>
            <td><button onclick="onOperatorClick('DEL')">DEL</button></td>
            <td><button class="div-by-zero" onclick="onOperationButtonClick('/')">/</button></td>
        </tr>
        <tr>
            <td><button onclick="numberPress('7')">7</button></td>
            <td><button onclick="numberPress('8')">8</button></td>
            <td><button onclick="numberPress('9')">9</button></td>
            <td><button class="div-by-zero" onclick="onOperationButtonClick('*')">*</button></td>
        </tr>
        <tr>
            <td><button onclick="numberPress('4')">4</button></td>
            <td><button onclick="numberPress('5')">5</button></td>
            <td><button onclick="numberPress('6')">6</button></td>
            <td><button class="div-by-zero" onclick="onOperationButtonClick('-')">-</button></td>
        </tr>
        <tr>
            <td><button onclick="numberPress('1')">1</button></td>
            <td><button onclick="numberPress('2')">2</button></td>
            <td><button onclick="numberPress('3')">3</button></td>
            <td><button class="div-by-zero" onclick="onOperationButtonClick('+')">+</button></td>
        </tr>
        <tr>
            <td><button class="div-by-zero" onclick="onOperatorClick('+/-')">+/-</button></td>
            <td><button onclick="numberPress('0')">0</button></td>
            <td><button class="div-by-zero" onclick="onOperatorClick('.')">.</button></td>
            <td><button onclick="onEqualClick()">=</button></td>
        </tr>                         
    </table>

    <div id="display-memory-list">
            <span id="memory-stack-display"></span>
    </div>
 
  </body>
</html>


<script type="text/javascript">
var display = "0";
var lastButtonOperator = false;
var calculations = [];
var history = [];
var buttonState = true; //Might not need to exist.
updateDisplay();
// TODO: set buttonState to true when =, CE, or C are pressed.
// TODO: make method less thicc.
// Created 10/17/2019 by Neel Mansukhani
// Edited 10/19/2019 by David Wing: added CE and C routes
// Operators handled here and updates display
function onOperatorClick(symbol) {
    if(lastButtonOperator) {
        if(symbol == ".") {
            display = "0.";
            lastButtonOperator = false;
        } else if(symbol == "+/-") {
            if(display.charAt(0) == '-') {
                display = display.substr(1);
            } else {
                display = "-" + display;
            }            
        } else if (symbol == "C") {
            display = "0"
            buttonState = true;
            calculations = [];
        } else if (symbol == "CE") {
            display = "0"
            buttonState = true;
        } 
    } else {
        if(symbol == "+/-" && display != "0") {
            if(display.charAt(0) == '-') {
                display = display.substr(1);
            } else {
                display = "-" + display;
            }
        } else if (symbol == "DEL") {
            if(!buttonState) {
                buttonState = true;
                display = "0"
            }            
            if(display != "0") {
                display = display.substr(0, display.length - 1);
                if(display.length == 0 || display == "-") {
                    display = "0";
                }
            }    
        } 
    }
    updateDisplay();
}


//created by David Wing 10/21/19
// handles numbers pressed on calc and updates display
function numberPress(symbol){
    if(lastButtonOperator) {
        if(!isNaN(symbol)) {
            buttonState = true;
            display = symbol;
            lastButtonOperator = false;
        } else {
            if(!buttonState) {
                buttonState = true;
                display = "0"
                lastButtonOperator = false;            
            }
        }
    }else{
        if(!isNaN(symbol)) {
            if(!buttonState) {
                buttonState = true;
                display = "0"
            }
            if(display == "0") {
                display = symbol;
            } else {
                display += symbol;
            }
        }
    }
    updateDisplay();
}

// Created 10/17/2019 by Neel Mansukhani
// Edited 10/20/2019 by Sri Ramya Dandu: Button enable/disable
// Updates the display after new calculations.
function updateDisplay() {
    document.getElementById("display").innerHTML = display;
    document.getElementById("calculations").innerHTML = calculations.toString().replace(/,/g," ");
    document.getElementById('MC').disabled = memory.length < 1;
    document.getElementById('MR').disabled = memory.length < 1;
    document.getElementById('M').disabled = memory.length < 1;
    if (memory.length < 1){
        hideMemory();
    }
    // document.getElementById("memory").innerHTML = memory;
    // document.getElementById("history").innerHTML = history;
    setButtonState(buttonState);
}

// Created 10/17/2019 by Neel Mansukhani
// Operation button clicks are registered here then display is updated.
function onOperationButtonClick(operation) {
    if(isOperator(calculations[calculations.length - 1]) && lastButtonOperator) {
        calculations[calculations.length - 1] = operation;
    } else {
        calculations.push(parseFloat(display));
        calculations.push(operation);
        display = calculateCalculations();    
    }
    lastButtonOperator = true;
    updateDisplay();
}
// Created 10/17/2019 by Neel Mansukhani
// Edited 10/19/2019 by David Wing: added C as an operator
// Returns whether the given parameter is an operator.
function isOperator(input) {
    return input == "+" || input == "-" || input == "*" || input == "/" || input == "C" || input == "CE";
}

// Created 10/17/2019 by Neel Mansukhani
// Does all of the math in the calculations array.
function calculateCalculations() {
    var calcValue;
    if(calculations.length < 3) {
        calcValue = parseFloat(display);
    } else {     
        calcValue = doMath(calculations[0], calculations[2], calculations[1]);
        if(typeof calcValue == "string") {
            return calcValue;
        }
        for(var i = 3; i < calculations.length; i++) {// TODO: Make Better
            if(i % 2 == 1) {
                operator = calculations[i];
            } else {
                calcValue = doMath(calcValue, calculations[i],operator);
                if(typeof calcValue == "string") {
                    return calcValue;
                }        
            }
        }
    }
    return calcValue;
}

// Created 10/17/2019 by Neel Mansukhani
// Does math between two numbers based on the given operator.
function doMath(num1, num2, operator) {
    var value = 0;
    switch(operator) {
            case "+":
                value = num1 + num2;
                break;
            case "-":
                value = num1 - num2;
                break;
            case "*":
                value = num1 * num2;
                break;
            case "/":
                if(num2 == 0) {
                    if(num1 == 0) {
                        value = "Result is undefined";
                    } else {
                        value = "Cannot divide by zero";
                    }
                    buttonState = false;
                    calculations = [];
                } else {
                    value = num1 / num2;  
                }
                break;
            case "C":
                value = 0;
                calculations = [];
                break;
            default:
                break;
        }
    return value; 
}

// Created 10/17/2019 by Neel Mansukhani
// Disables or enables buttons as a result of divide by zero.
function setButtonState() {
    var buttons = document.getElementsByClassName("div-by-zero");
    for(var i = 0; i < buttons.length; i++) {
        buttons[i].disabled = !buttonState;
    }    
}

</script>